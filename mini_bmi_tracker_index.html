<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¿·ä½ å¥åº·è¿½è¹¤å·¥å…· - BMI ç´€éŒ„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
    }

    .container {
      width: 100%;
      max-width: 960px;
      margin: 24px;
      background: rgba(30, 41, 59, 0.78);
      border-radius: 20px;
      border: 1px solid rgba(51, 65, 85, 0.5);
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.45),
        0 0 0 1px rgba(148, 163, 184, 0.08);
      padding: 24px 24px 28px;
      backdrop-filter: blur(22px);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.6);
      padding: 24px 24px 28px;
      backdrop-filter: blur(18px);
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .title-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-icon {
      width: 36px;
      height: 36px;
      border-radius: 14px;
      background: conic-gradient(from 160deg, #2563eb, #a855f7, #f97316, #22c55e, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 1.2rem;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
    }

    h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.02em;
      color: #f1f5f9;
    }

    .subtitle {
      margin: 2px 0 0;
      font-size: 0.85rem;
      color: #cbd5e1;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 500;
      color: #1d4ed8;
      background: rgba(219, 234, 254, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .chip-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 5px rgba(34, 197, 94, 0.15);
    }

    .form-card {
      margin-top: 18px;
      padding: 14px 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, #1e293b, #334155);
      border: 1px solid rgba(129, 140, 248, 0.4);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: flex-end;
    }

    .field {
      flex: 1 1 160px;
      min-width: 150px;
    }

    label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.82rem;
      margin-bottom: 4px;
      color: #4b5563;
    }

    .unit-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.18);
      font-size: 0.7rem;
      color: #cbd5e1;
    }

    .input-shell {
      position: relative;
    }

    .input-shell::before {
      content: attr(data-icon);
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      color: #9ca3af;
      pointer-events: none;
    }

    input[type="number"] {
      width: 100%;
      padding: 9px 10px 9px 28px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 0.9rem;
      outline: none;
      background: rgba(255, 255, 255, 0.9);
      transition:
        border-color 0.14s ease,
        box-shadow 0.14s ease,
        background 0.14s ease,
        transform 0.1s ease;
    }

    input[type="number"]:focus {
      border-color: #6366f1;
      box-shadow:
        0 0 0 1px rgba(129, 140, 248, 0.35),
        0 10px 20px rgba(129, 140, 248, 0.25);
      background: #ffffff;
      transform: translateY(-0.5px);
    }

    button {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      letter-spacing: 0.02em;
    }

    #recordBtn {
      background: linear-gradient(135deg, #4f46e5, #2563eb);
      color: #ffffff;
      box-shadow:
        0 12px 28px rgba(37, 99, 235, 0.6),
        0 0 0 1px rgba(191, 219, 254, 0.6);
      transition:
        transform 0.12s ease,
        box-shadow 0.12s ease,
        filter 0.12s ease;
    }

    #recordBtn:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
      box-shadow:
        0 16px 32px rgba(37, 99, 235, 0.75);
    }

    #recordBtn:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.55);
    }

    .current-box {
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(51, 65, 85, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.28);
      font-size: 0.88rem;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 10px;
      align-items: center;
    }

    .current-box span {
      margin-right: 4px;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.78rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-normal {
      background: #dcfce7;
      color: #166534;
    }

    .badge-warning {
      background: #fef3c7;
      color: #92400e;
    }

    .badge-danger {
      background: #fee2e2;
      color: #b91c1c;
    }

    .section-title {
      margin-top: 24px;
      margin-bottom: 6px;
      font-size: 0.98rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #0f172a;
    }

    .section-title small {
      font-size: 0.78rem;
      color: #9ca3af;
      font-weight: normal;
    }

    .section-pill {
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.04);
      font-size: 0.7rem;
      color: #cbd5e1;
    }

    .chart-wrapper {
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.28);
      padding: 12px;
      background: linear-gradient(135deg, #1e293b, #0f172a);
    }

    #bmiChart {
      width: 100%;
      max-height: 260px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.82rem;
    }

    thead {
      background: linear-gradient(90deg, #334155, #1e293b);
    }

    th,
    td {
      padding: 6px 8px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      font-size: 0.8rem;
      color: #4b5563;
    }

    tbody tr:nth-child(even) {
      background: rgba(30, 41, 59, 0.55);
    }

    tbody tr:hover {
      background: rgba(51, 65, 85, 0.6);
    }

    .empty-tip {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 4px;
    }

    .footer-hint {
      margin-top: 10px;
      font-size: 0.75rem;
      color: #9ca3af;
      text-align: right;
    }

    body.theme-light {
      background: linear-gradient(135deg, #eef2ff 0%, #f8fafc 50%, #e0f2fe 100%);
    }

    body.theme-light .container {
      background: rgba(255, 255, 255, 0.92);
      border-color: rgba(148, 163, 184, 0.25);
      box-shadow:
        0 18px 45px rgba(15, 23, 42, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.7);
    }

    body.theme-light h1 {
      color: #0f172a;
    }

    body.theme-light .subtitle {
      color: #6b7280;
    }

    body.theme-light .current-box {
      background: rgba(248, 250, 252, 0.94);
      border-color: rgba(226, 232, 240, 0.9);
    }

    body.theme-light .chart-wrapper {
      background: linear-gradient(135deg, #f9fafb, #eff6ff);
    }

    body.theme-light thead {
      background: linear-gradient(90deg, #f1f5f9, #e5e7eb);
    }

    body.theme-light tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    body.theme-light tbody tr:hover {
      background: #eff6ff;
    }

    .theme-toggle {
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      font-size: 0.78rem;
      font-weight: 500;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    body.theme-light .theme-toggle {
      background: rgba(255, 255, 255, 0.95);
      color: #111827;
      border-color: rgba(148, 163, 184, 0.6);
    }

    @media (max-width: 720px) {
      .container {
        margin: 16px;
        padding: 18px 16px 22px;
      }

      .header-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .chip {
        align-self: flex-start;
      }

      .form-card {
        margin-top: 12px;
      }

      h1 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-row">
      <div class="title-block">
        <div class="title-icon">ğŸ’“</div>
        <div>
          <h1>è¿·ä½ å¥åº·è¿½è¹¤å·¥å…·</h1>
          <p class="subtitle">è¼¸å…¥èº«é«˜èˆ‡é«”é‡ï¼Œä¸€éµè¨ˆç®— BMI ä¸¦è¨˜éŒ„æœ€è¿‘ 30 ç­†æ­·å²è³‡æ–™ã€‚</p>
        </div>
      </div>
      <button id="themeToggle" type="button" class="theme-toggle">ğŸŒ™ å¤œé–“æ¨¡å¼</button>
    </div>

    <div class="form-row">
      <div class="field">
        <label for="height">èº«é«˜ <span class="unit">(cm)</span></label>
        <input type="number" id="height" min="50" max="250" step="0.1" placeholder="ä¾‹å¦‚ï¼š165" />
      </div>
      <div class="field">
        <label for="weight">é«”é‡ <span class="unit">(kg)</span></label>
        <input type="number" id="weight" min="10" max="300" step="0.1" placeholder="ä¾‹å¦‚ï¼š60" />
      </div>
      <div class="field" style="flex: 0 0 auto;">
        <button id="recordBtn" type="button">ğŸ“Œ ç´€éŒ„</button>
      </div>
    </div>

    <div id="currentInfo" class="current-box">
      <span>ç›®å‰å°šæœªæœ‰ç´€éŒ„ï¼Œè«‹å…ˆè¼¸å…¥æ•¸å€¼å¾ŒæŒ‰ã€Œç´€éŒ„ã€ã€‚</span>
    </div>

    <h2 class="section-title">BMI è®ŠåŒ–åœ– <small>æœ€è¿‘ 30 ç­†</small></h2>
    <div class="chart-wrapper">
      <canvas id="bmiChart" width="800" height="260"></canvas>
      <div id="chartEmpty" class="empty-tip">å°šç„¡è³‡æ–™ï¼Œåœ–è¡¨å°‡åœ¨æœ‰ç´€éŒ„å¾Œè‡ªå‹•æ›´æ–°ã€‚</div>
    </div>

    <h2 class="section-title">æ­·å²ç´€éŒ„ <small>æœ€è¿‘ 30 ç­†ï¼ˆæ–°åˆ°èˆŠï¼‰</small></h2>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>æ™‚é–“</th>
            <th>èº«é«˜ (cm)</th>
            <th>é«”é‡ (kg)</th>
            <th>BMI</th>
            <th>ç‹€æ…‹</th>
          </tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
      <div id="historyEmpty" class="empty-tip">å°šç„¡ä»»ä½•ç´€éŒ„ã€‚</div>
    </div>
  </div>

  <script>
    (function () {
      "use strict";

      const STORAGE_KEY = "mini_bmi_records";
      const THEME_KEY = "mini_bmi_theme";

      const heightInput = document.getElementById("height");
      const weightInput = document.getElementById("weight");
      const recordBtn = document.getElementById("recordBtn");
      const currentInfo = document.getElementById("currentInfo");
      const historyBody = document.getElementById("historyBody");
      const historyEmpty = document.getElementById("historyEmpty");
      const chartEmpty = document.getElementById("chartEmpty");
      const chartCanvas = document.getElementById("bmiChart");
      const themeToggle = document.getElementById("themeToggle");
      const ctx = chartCanvas.getContext("2d");

      function loadRecords() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed;
        } catch (e) {
          console.error("loadRecords error", e);
          return [];
        }
      }

      function saveRecords(records) {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
        } catch (e) {
          console.error("saveRecords error", e);
        }
      }

      function classifyBMI(bmi) {
        if (bmi < 18.5) {
          return { label: "é«”é‡éè¼•", level: "low" };
        } else if (bmi < 24) {
          return { label: "æ­£å¸¸ç¯„åœ", level: "normal" };
        } else if (bmi < 27) {
          return { label: "éé‡", level: "warning" };
        } else {
          return { label: "è‚¥èƒ–", level: "danger" };
        }
      }

      function formatDate(isoString) {
        const d = new Date(isoString);
        if (Number.isNaN(d.getTime())) return "--";
        return d.toLocaleString("zh-TW", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function renderCurrent(records) {
        if (!records.length) {
          currentInfo.innerHTML = "<span>ç›®å‰å°šæœªæœ‰ç´€éŒ„ï¼Œè«‹å…ˆè¼¸å…¥æ•¸å€¼å¾ŒæŒ‰ã€Œç´€éŒ„ã€ã€‚</span>";
          return;
        }
        const latest = records[records.length - 1];
        const bmiClass = classifyBMI(latest.bmi);

        let badgeClass = "badge-normal";
        if (bmiClass.level === "warning") badgeClass = "badge-warning";
        if (bmiClass.level === "danger") badgeClass = "badge-danger";

        const message =
          bmiClass.level === "normal"
            ? "BMI åœ¨åœ‹å®¶æ¨™æº–æ­£å¸¸ç¯„åœå…§ (18.5â€“24)ã€‚"
            : "BMI è¶…å‡ºåœ‹å®¶æ¨™æº–æ­£å¸¸ç¯„åœ (18.5â€“24)ï¼Œå»ºè­°ç•™æ„é£²é£Ÿèˆ‡é‹å‹•ã€‚";

        currentInfo.innerHTML =
          `<span>æœ€è¿‘ä¸€æ¬¡ç´€éŒ„æ™‚é–“ï¼š${formatDate(latest.timestamp)}</span>` +
          `<span>èº«é«˜ï¼š${latest.height.toFixed(1)} cmï¼Œé«”é‡ï¼š${latest.weight.toFixed(1)} kg</span>` +
          `<span>ç›®å‰ BMIï¼š<strong>${latest.bmi.toFixed(2)}</strong></span>` +
          `<span class="badge ${badgeClass}">${bmiClass.label}</span>` +
          `<span style="flex-basis: 100%; font-size: 0.8rem; color: #cbd5e1; margin-top: 4px;">${message}</span>`;
      }

      function renderHistory(records) {
        historyBody.innerHTML = "";
        if (!records.length) {
          historyEmpty.style.display = "block";
          return;
        }
        historyEmpty.style.display = "none";

        const reversed = [...records].reverse();
        const rows = reversed
          .map((r) => {
            const bmiClass = classifyBMI(r.bmi);
            let badgeClass = "badge-normal";
            if (bmiClass.level === "warning") badgeClass = "badge-warning";
            if (bmiClass.level === "danger") badgeClass = "badge-danger";
            return `
              <tr>
                <td>${formatDate(r.timestamp)}</td>
                <td>${r.height.toFixed(1)}</td>
                <td>${r.weight.toFixed(1)}</td>
                <td>${r.bmi.toFixed(2)}</td>
                <td><span class="badge ${badgeClass}">${bmiClass.label}</span></td>
              </tr>
            `;
          })
          .join("");
        historyBody.innerHTML = rows;
      }

      function clearChart() {
        ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
      }

      function renderChart(records) {
        clearChart();
        if (!records.length) {
          chartEmpty.style.display = "block";
          return;
        }
        chartEmpty.style.display = "none";

        const data = records.map((r) => r.bmi);
        const n = data.length;
        const padding = 30;
        const width = chartCanvas.width;
        const height = chartCanvas.height;

        let minY = Math.min(...data);
        let maxY = Math.max(...data);
        if (minY === maxY) {
          minY -= 1;
          maxY += 1;
        }
        const range = maxY - minY;
        minY = Math.floor(minY - range * 0.1);
        maxY = Math.ceil(maxY + range * 0.1);

        function xScale(i) {
          if (n === 1) return padding + (width - 2 * padding) / 2;
          return padding + (i * (width - 2 * padding)) / (n - 1);
        }

        function yScale(v) {
          return height - padding - ((v - minY) * (height - 2 * padding)) / (maxY - minY);
        }

        ctx.lineWidth = 1;
        ctx.strokeStyle = "#d1d5db";
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, height - padding);
        ctx.lineTo(width - padding, height - padding);
        ctx.stroke();

        ctx.font = "10px system-ui";
        ctx.fillStyle = "#9ca3af";
        ctx.textAlign = "right";
        ctx.textBaseline = "middle";

        const ticks = 4;
        for (let i = 0; i <= ticks; i++) {
          const value = minY + ((maxY - minY) * i) / ticks;
          const y = yScale(value);
          ctx.fillText(value.toFixed(1), padding - 4, y);
          ctx.strokeStyle = "#e5e7eb";
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(width - padding, y);
          ctx.stroke();
        }

        ctx.strokeStyle = "#2563eb";
        ctx.lineWidth = 2;
        ctx.beginPath();
        data.forEach((v, i) => {
          const x = xScale(i);
          const y = yScale(v);
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        });
        ctx.stroke();

        ctx.fillStyle = "#2563eb";
        data.forEach((v, i) => {
          const x = xScale(i);
          const y = yScale(v);
          ctx.beginPath();
          ctx.arc(x, y, 3, 0, Math.PI * 2);
          ctx.fill();
        });

        const normalMin = 18.5;
        const normalMax = 24;
        if (normalMin > minY && normalMin < maxY) {
          ctx.strokeStyle = "#22c55e";
          ctx.setLineDash([4, 4]);
          ctx.beginPath();
          ctx.moveTo(padding, yScale(normalMin));
          ctx.lineTo(width - padding, yScale(normalMin));
          ctx.stroke();
        }
        if (normalMax > minY && normalMax < maxY) {
          ctx.strokeStyle = "#22c55e";
          ctx.setLineDash([4, 4]);
          ctx.beginPath();
          ctx.moveTo(padding, yScale(normalMax));
          ctx.lineTo(width - padding, yScale(normalMax));
          ctx.stroke();
        }
        ctx.setLineDash([]);

        ctx.fillStyle = "#6b7280";
        ctx.textAlign = "center";
        ctx.textBaseline = "top";
        ctx.fillText("ç´€éŒ„é †åºï¼ˆèˆŠ â†’ æ–°ï¼‰", width / 2, height - padding + 6);
      }

      function refreshUI(records) {
        renderCurrent(records);
        renderHistory(records);
        renderChart(records);
      }

      function applyTheme(theme) {
        if (theme === "light") {
          document.body.classList.add("theme-light");
        } else {
          document.body.classList.remove("theme-light");
          theme = "dark";
        }

        if (themeToggle) {
          if (theme === "light") {
            themeToggle.textContent = "â˜€ï¸ æ—¥é–“æ¨¡å¼";
          } else {
            themeToggle.textContent = "ğŸŒ™ å¤œé–“æ¨¡å¼";
          }
        }

        try {
          localStorage.setItem(THEME_KEY, theme);
        } catch (e) {
          console.error("save theme error", e);
        }
      }

      function handleRecord() {
        const h = parseFloat(heightInput.value);
        const w = parseFloat(weightInput.value);

        if (!h || !w || h <= 0 || w <= 0) {
          alert("è«‹è¼¸å…¥æ­£ç¢ºçš„èº«é«˜èˆ‡é«”é‡æ•¸å€¼ã€‚");
          return;
        }

        const heightM = h / 100;
        const bmi = w / (heightM * heightM);

        const now = new Date();
        const record = {
          timestamp: now.toISOString(),
          height: h,
          weight: w,
          bmi: bmi,
        };

        let records = loadRecords();
        records.push(record);
        if (records.length > 30) {
          records = records.slice(records.length - 30);
        }
        saveRecords(records);
        refreshUI(records);
      }

      recordBtn.addEventListener("click", handleRecord);

      if (themeToggle) {
        themeToggle.addEventListener("click", function () {
          const isLight = document.body.classList.contains("theme-light");
          applyTheme(isLight ? "dark" : "light");
        });
      }

      const initialRecords = loadRecords();
      let initialTheme = "dark";
      try {
        const stored = localStorage.getItem(THEME_KEY);
        if (stored === "light" || stored === "dark") {
          initialTheme = stored;
        }
      } catch (e) {
        console.error("load theme error", e);
      }
      applyTheme(initialTheme);
      refreshUI(initialRecords);
    })();
  </script>
</body>
</html>
